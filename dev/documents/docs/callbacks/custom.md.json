{"attributes":{"backlinks":[{"tag":"document","title":"Callback reference","docid":"documents/docs/callbacks/reference.md"},{"tag":"documentation","title":"Callback","docid":"references/FluxTraining.Callback"},{"tag":"documentation","title":"Learner","docid":"references/FluxTraining.Learner"},{"tag":"document","title":"toc","docid":"documents/toc.md"},{"tag":"document","title":"Hyperparameter scheduling","docid":"documents/docs/tutorials/hyperparameters.md"},{"tag":"document","title":"How to use callbacks","docid":"documents/docs/callbacks/usage.md"},{"tag":"document","title":"FluxTraining.jl","docid":"documents/README.md"},{"tag":"document","title":"Getting started","docid":"documents/docs/overview.md"}],"path":"/home/runner/.julia/packages/FluxTraining/2sFqe/docs/callbacks/custom.md","title":"Custom callbacks"},"tag":"document","children":[{"attributes":{},"tag":"h1","children":[{"mimes":{"text/plain":"Custom callbacks"}}]},{"attributes":{},"tag":"p","children":[{"attributes":{},"tag":"em","children":[{"mimes":{"text/plain":"FluxTraining"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":"jl"}}]},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"s callback system is built around multiple dispatch, so you specify which part of the training you want to "}},{"mimes":{"text/plain":"“"}},{"mimes":{"text/plain":"hook into"}},{"mimes":{"text/plain":"”"}},{"mimes":{"text/plain":" by dispatching on "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Phases.Phase"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Phase"}}]}]},{"mimes":{"text/plain":"s and "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Event"}}]},{"mimes":{"text/plain":"s"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" See "}},{"attributes":{"reftype":"document","href":"/documents/docs/tutorials/training.md","title":"","document_id":"documents/docs/tutorials/training.md"},"tag":"reference","children":[{"mimes":{"text/plain":"Training loop"}}]},{"mimes":{"text/plain":" and "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Events"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Events"}}]}]},{"mimes":{"text/plain":" as a reference to phases and events"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"h2","children":[{"mimes":{"text/plain":"A guided example"}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"There are 4 things you need to do to implement a custom callback:"}}]},{"attributes":{},"tag":"ul","children":[{"attributes":{},"tag":"li","children":[{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"Create a callback "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"struct"}}]},{"mimes":{"text/plain":" that subtypes "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Callback"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Callback"}}]}]}]}]},{"attributes":{},"tag":"li","children":[{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"Write event handlers with "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.on"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"on"}}]}]}]}]},{"attributes":{},"tag":"li","children":[{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"Define what state the callback accesses by implementing "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.stateaccess"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"stateaccess"}}]}]}]}]},{"attributes":{},"tag":"li","children":[{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"(Optionally) define dependencies on other callbacks with "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.runafter"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"runafter"}}]}]}]}]}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"Let"}},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"s go through them one at a time by implementing a simple callback that prints something after every batch"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"h3","children":[{"mimes":{"text/plain":"Callback "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"struct"}}]}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"A callback definition has to subtype the abstract "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Callback"}}]},{"mimes":{"text/plain":" type"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" It can include fields to use as internal state, but we don"}},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"t need that here"}},{"mimes":{"text/plain":"."}}]},{"attributes":{"lang":"julia"},"tag":"codeblock","children":[{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_struct","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_KEYWORD","children":[{"mimes":{"text/plain":"struct"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_FALSE","children":[{"mimes":{"text/plain":""}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"Printer"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"<: "}}]},{"attributes":{},"tag":"CST_span","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Callback"},"tag":"reference","children":[{"mimes":{"text/plain":"Callback"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":"\n"}}]}]}]},{"attributes":{},"tag":"CST_block","children":[{"mimes":{"text/plain":""}}]},{"attributes":{},"tag":"CST_KEYWORD","children":[{"mimes":{"text/plain":"end"}}]}]}]}]},{"attributes":{},"tag":"h3","children":[{"mimes":{"text/plain":"Event handlers"}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"Now we need to add an event handler so that "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Printer"}}]},{"mimes":{"text/plain":" can run some code when a step ends"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" Event handlers can be defined by adding a method to "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"FluxTraining.on"}}]},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" It takes as arguments an "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Events.Event"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Event"}}]}]},{"mimes":{"text/plain":", a "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Phases.Phase"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Phase"}}]}]},{"mimes":{"text/plain":", the callback and the learner:"}}]},{"attributes":{},"tag":"p","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"on(event::Event, phase::Phase, callback::Callback, learner)"}}]}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"The "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"event"}}]},{"mimes":{"text/plain":", "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"phase"}}]},{"mimes":{"text/plain":" and "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"callback"}}]},{"mimes":{"text/plain":" are used to dispatch"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"In this case, we want to run code at the end of a step, so the event we need to dispatch on is "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Events.StepEnd"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"StepEnd"}}]}]},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" We want it to run in any phase, so we use the abstract type "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Phase"}}]},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" The third argument type is the callback we want to add an event handler to"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" This gives us:"}}]},{"attributes":{"lang":"julia"},"tag":"codeblock","children":[{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_function","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_KEYWORD","children":[{"mimes":{"text/plain":"function"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining"},"tag":"reference","children":[{"mimes":{"text/plain":"FluxTraining"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_quotenode","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.on"},"tag":"reference","children":[{"mimes":{"text/plain":"on"}}]}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"(\n        "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"event"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Events.StepEnd"},"tag":"reference","children":[{"mimes":{"text/plain":"StepEnd"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",\n        "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"phase"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Phases.Phase"},"tag":"reference","children":[{"mimes":{"text/plain":"Phase"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",\n        "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"printer"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"Printer"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",\n        "}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"learner"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")\n    "}}]}]},{"attributes":{},"tag":"CST_block","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"println"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_STRING","children":[{"mimes":{"text/plain":"\"Hello, World!\""}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")\n"}}]}]}]},{"attributes":{},"tag":"CST_KEYWORD","children":[{"mimes":{"text/plain":"end"}}]}]}]}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"We can now pass an instance of "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Printer"}}]},{"mimes":{"text/plain":" when creating a "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Learner"}}]},{"mimes":{"text/plain":" and the message will be printed at the end of every step"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"h3","children":[{"mimes":{"text/plain":"State"}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"As seen above, the callback handler "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"on"}}]},{"mimes":{"text/plain":" receives as the last argument a "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Learner"}}]},{"mimes":{"text/plain":" instance, allowing the callback to access and modify state"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" If we wanted to print the last step"}},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"s loss instead of a generic message, we could update our definition of "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"on"}}]},{"mimes":{"text/plain":":"}}]},{"attributes":{"lang":"julia"},"tag":"codeblock","children":[{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_function","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_KEYWORD","children":[{"mimes":{"text/plain":"function"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining"},"tag":"reference","children":[{"mimes":{"text/plain":"FluxTraining"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_quotenode","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.on"},"tag":"reference","children":[{"mimes":{"text/plain":"on"}}]}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"(\n        "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"event"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Events.EpochEnd"},"tag":"reference","children":[{"mimes":{"text/plain":"EpochEnd"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",\n        "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"phase"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Phases.Phase"},"tag":"reference","children":[{"mimes":{"text/plain":"Phase"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",\n        "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"printer"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"Printer"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",\n        "}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"learner"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")\n    "}}]}]},{"attributes":{},"tag":"CST_block","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"println"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_STRING","children":[{"mimes":{"text/plain":"\"Step loss:\""}}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"learner"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_quotenode","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"step"}}]}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_quotenode","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"loss"}}]}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")\n"}}]}]}]},{"attributes":{},"tag":"CST_KEYWORD","children":[{"mimes":{"text/plain":"end"}}]}]}]}]},{"attributes":{},"tag":"p","children":[{"attributes":{},"tag":"em","children":[{"mimes":{"text/plain":"(see "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Learner"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Learner"}}]}]},{"mimes":{"text/plain":" for in"}},{"mimes":{"text/plain":"-"}},{"mimes":{"text/plain":"depth documentation of the "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Learner"}}]},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"s state)"}}]}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"The ability to modify any state is very powerful, but it can quickly become problematic when it is unclear which callbacks modify what state and what the correct order should be"}},{"mimes":{"text/plain":"."}},{"attributes":{},"tag":"br","children":[]},{"mimes":{"text/plain":"Because of that, "}},{"attributes":{},"tag":"em","children":[{"mimes":{"text/plain":"FluxTraining"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":"jl"}}]},{"mimes":{"text/plain":" prevents callbacks from reading and modifying state by default"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" If we tried to use the above redefinition of "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"on"}}]},{"mimes":{"text/plain":", we would get the following error:"}}]},{"attributes":{"lang":"julia"},"tag":"codeblock","children":[{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining"},"tag":"reference","children":[{"mimes":{"text/plain":"FluxTraining"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_quotenode","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.ProtectedException"},"tag":"reference","children":[{"mimes":{"text/plain":"ProtectedException"}}]}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_STRING","children":[{"mimes":{"text/plain":"\"Read access to Learner.step.loss disallowed.\""}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")"}}]}]}]}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"To fix that error, we need to implement "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"stateaccess"}}]},{"mimes":{"text/plain":", a function that specifies what state a callback is allowed to read and write"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" In our case, we want to read the loss of the current step:"}}]},{"attributes":{"lang":"julia"},"tag":"codeblock","children":[{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining"},"tag":"reference","children":[{"mimes":{"text/plain":"FluxTraining"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_quotenode","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.stateaccess"},"tag":"reference","children":[{"mimes":{"text/plain":"stateaccess"}}]}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"Printer"}}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":") "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_block","children":[{"attributes":{},"tag":"CST_tuple","children":[{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"step"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_tuple","children":[{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"loss"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Read"},"tag":"reference","children":[{"mimes":{"text/plain":"Read"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")"}}]}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":","}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")"}}]}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":","}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")"}}]}]}]}]}]}]},{"attributes":{},"tag":"p","children":[{"attributes":{},"tag":"em","children":[{"mimes":{"text/plain":"(see "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.stateaccess"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"stateaccess"}}]}]},{"mimes":{"text/plain":" for more information on how to implement it)"}}]}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"After that definition, the above code will run fine"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" This might seem bothersome, but this extra information makes it possible to analyze state dependencies before any code is run and saves you from running into nasty, hard"}},{"mimes":{"text/plain":"-"}},{"mimes":{"text/plain":"to"}},{"mimes":{"text/plain":"-"}},{"mimes":{"text/plain":"find bugs that can occur when using many callbacks together"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"h3","children":[{"mimes":{"text/plain":"Dependencies"}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"Let"}},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"s improve our callback a bit by adding the current step number to the printed message, so it will look like this: "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"\"Step 14 loss: 0.0032\""}}]},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" For that we need to know what the current number of steps is"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" One way to go about this is to add a field to "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Printer"}}]},{"mimes":{"text/plain":" that starts at "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"0"}}]},{"mimes":{"text/plain":" and is incremented every step"}},{"mimes":{"text/plain":"."}},{"attributes":{},"tag":"br","children":[]},{"mimes":{"text/plain":"Luckily, there already is a callback that tracks this kind of statistics, the "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Recorder"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Recorder"}}]}]},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" It uses a special piece of state, "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"learner.cbstate"}}]},{"mimes":{"text/plain":", to store a "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.History"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"History"}}]}]},{"mimes":{"text/plain":" with this information"}},{"mimes":{"text/plain":"."}}]},{"attributes":{"class":"info"},"tag":"admonition","children":[{"attributes":{},"tag":"admonitiontitle","children":[{"mimes":{"text/plain":"Callback state"}}]},{"attributes":{},"tag":"admonitionbody","children":[{"attributes":{},"tag":"p","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"learner.cbstate"}}]},{"mimes":{"text/plain":" is an object where callbacks can store state that they want to make available to other callbacks"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" Like any other piece of state, the callback writing to it needs to add a "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Write()"}}]},{"mimes":{"text/plain":" permission to it using "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.stateaccess"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"stateaccess"}}]}]},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"What makes "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"cbstate"}}]},{"mimes":{"text/plain":" special is that when creating the callback graph, it is checked that every entry in "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"cbstate"}}]},{"mimes":{"text/plain":" that is accessed is being created first"}},{"mimes":{"text/plain":"."}}]}]}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"The update to the event handler looks like this:"}}]},{"attributes":{"lang":"julia"},"tag":"codeblock","children":[{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_function","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_KEYWORD","children":[{"mimes":{"text/plain":"function"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining"},"tag":"reference","children":[{"mimes":{"text/plain":"FluxTraining"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_quotenode","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.on"},"tag":"reference","children":[{"mimes":{"text/plain":"on"}}]}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"(\n        "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"event"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Events.EpochEnd"},"tag":"reference","children":[{"mimes":{"text/plain":"EpochEnd"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",\n        "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"phase"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Phases.Phase"},"tag":"reference","children":[{"mimes":{"text/plain":"Phase"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",\n        "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"printer"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"Printer"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",\n        "}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"learner"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")\n    "}}]}]},{"attributes":{},"tag":"CST_block","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"step"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_ref","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"learner"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_quotenode","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"cbstate"}}]}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_quotenode","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"history"}}]}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"["}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"phase"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"]"}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_quotenode","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"stepsepoch"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":"  # steps completed in current epoch\n    "}}]}]}]}]}]},{"attributes":{},"tag":"CST_tuple","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"println"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_STRING","children":[{"mimes":{"text/plain":"\"Step \""}}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_errortoken","children":[{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":""}}]}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_STRING","children":[{"mimes":{"text/plain":"\" loss:\""}}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"learner"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_quotenode","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"step"}}]}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_errortoken","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"loss"}}]},{"attributes":{},"tag":"CST_errortoken","children":[{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")\n"}}]}]}]}]}]}]},{"attributes":{},"tag":"CST_KEYWORD","children":[{"mimes":{"text/plain":"end"}}]}]}]}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"We also need to update the definition of "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"stateaccess"}}]},{"mimes":{"text/plain":" now:"}}]},{"attributes":{"lang":"julia"},"tag":"codeblock","children":[{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining"},"tag":"reference","children":[{"mimes":{"text/plain":"FluxTraining"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_quotenode","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.stateaccess"},"tag":"reference","children":[{"mimes":{"text/plain":"stateaccess"}}]}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"Printer"}}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":") "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_block","children":[{"attributes":{},"tag":"CST_tuple","children":[{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"(\n    "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"step"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_tuple","children":[{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"loss"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Read"},"tag":"reference","children":[{"mimes":{"text/plain":"Read"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")"}}]}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":","}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")"}}]}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",\n    "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"cbstate"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_tuple","children":[{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"history"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Read"},"tag":"reference","children":[{"mimes":{"text/plain":"Read"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")"}}]}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":","}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")"}}]}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",\n"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")"}}]}]}]}]}]}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"Since "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Printer"}}]},{"mimes":{"text/plain":" depends on "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Recorder"}}]},{"mimes":{"text/plain":" now, an error will be thrown if you try to use "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Printer"}}]},{"mimes":{"text/plain":" without "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Recorder"}}]},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" And that"}},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"s it, pass "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Printer"}}]},{"mimes":{"text/plain":" to a "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Learner"}}]},{"mimes":{"text/plain":" and test it out"}},{"mimes":{"text/plain":"!"}},{"mimes":{"text/plain":" The upside of jumping through some additional hoops is that using the callback in the wrong context will always result in an error, so the user can have peace of mind"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"h2","children":[{"mimes":{"text/plain":"Conflict resolution"}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"When creating a "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Learner"}}]},{"mimes":{"text/plain":", a dependency graph is created"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" The graph is then analyzed to find possible conflicts (for example, when two callbacks update the same state)"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" Conflicts are detected automatically and will result in an error"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" Conflicts happen when the same state is being modified by multiple callbacks and it is unclear which order of running them (if any) is valid"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"h3","children":[{"mimes":{"text/plain":"Resolving conflicts"}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"There are two methods for resolving conflicts, "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"runafter"}}]},{"mimes":{"text/plain":" and "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"resolveconflict"}}]},{"mimes":{"text/plain":"."}},{"attributes":{},"tag":"br","children":[]},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"runafter"}}]},{"mimes":{"text/plain":" allows you to define list of callbacks that should run before the callback"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" For example, "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Recorder"}}]},{"mimes":{"text/plain":" needs to run after all metrics:"}}]},{"attributes":{"lang":"julia"},"tag":"codeblock","children":[{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining"},"tag":"reference","children":[{"mimes":{"text/plain":"FluxTraining"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"CST_quotenode","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.runafter"},"tag":"reference","children":[{"mimes":{"text/plain":"runafter"}}]}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Recorder"},"tag":"reference","children":[{"mimes":{"text/plain":"Recorder"}}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":") "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_block","children":[{"attributes":{},"tag":"CST_tuple","children":[{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.AbstractMetric"},"tag":"reference","children":[{"mimes":{"text/plain":"AbstractMetric"}}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":","}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")"}}]}]}]}]}]}]},{"attributes":{},"tag":"p","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"resolveconflict"}}]},{"mimes":{"text/plain":" provides more granular control to handle a possible conflict between two callbacks"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" It takes two callbacks and defines how to resolve a conflict:"}}]},{"attributes":{"lang":"julia"},"tag":"codeblock","children":[{"attributes":{},"tag":"CST_COMMENT","children":[{"mimes":{"text/plain":"# the default, errors with a helpful message\n"}}]},{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.resolveconflict"},"tag":"reference","children":[{"mimes":{"text/plain":"resolveconflict"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"C1"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"C2"}}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":") "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_block","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"NotImplemented"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")    \n# two callbacks can never be used together:\n"}}]}]}]}]}]},{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.resolveconflict"},"tag":"reference","children":[{"mimes":{"text/plain":"resolveconflict"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"C1"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"C2"}}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":") "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_block","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Unresolvable"},"tag":"reference","children":[{"mimes":{"text/plain":"Unresolvable"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")      \n"}}]}]}]}]}]},{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.resolveconflict"},"tag":"reference","children":[{"mimes":{"text/plain":"resolveconflict"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"C1"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"C2"}}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":") "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_block","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.NoConflict"},"tag":"reference","children":[{"mimes":{"text/plain":"NoConflict"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")        # there is no conflict, any run order is fine\n"}}]}]}]}]}]},{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.resolveconflict"},"tag":"reference","children":[{"mimes":{"text/plain":"resolveconflict"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"cb1"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"C1"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"cb2"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"::"}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"C2"}}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":") "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_block","children":[{"attributes":{},"tag":"CST_call","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.RunFirst"},"tag":"reference","children":[{"mimes":{"text/plain":"RunFirst"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"cb1"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":") # `cb1` must run before `cb2`.\n                                                  # Equivalent to `runafter(::C2) = (C1,)"}}]}]}]}]}]}]},{"attributes":{},"tag":"h2","children":[{"mimes":{"text/plain":"Callback execution"}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"By default, a topological ordering of the callbacks is created from the dependency graph and the callbacks are executed serially"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" This behavior can be overwritten with custom callback executors, for example to create a "}},{"attributes":{},"tag":"em","children":[{"mimes":{"text/plain":"Dagger"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":"jl"}}]},{"mimes":{"text/plain":" node from the graph to allow callbacks to safely run in parallel where valid"}},{"mimes":{"text/plain":"."}}]}]}