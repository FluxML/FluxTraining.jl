{"attributes":{"kind":"const","backlinks":[],"name":"tests","title":"tests","symbol_id":"FluxTraining.##InlineTest-01b48f5c342f65df7fcd07f28f0d2cacbb09f0a0.tests","public":false,"module_id":"FluxTraining.##InlineTest-01b48f5c342f65df7fcd07f28f0d2cacbb09f0a0"},"tag":"documentation","children":[{"attributes":{},"tag":"codecell","children":[{"attributes":{"lang":"julia"},"tag":"codeinput","children":[{"attributes":{"lang":"julia"},"tag":"codeblock","children":[{"attributes":{},"tag":"julia","children":["FluxTraining.##InlineTest-01b48f5c342f65df7fcd07f28f0d2cacbb09f0a0.tests"],"type":"node"}],"type":"node"}],"type":"node"},{"attributes":{},"tag":"coderesult","children":[{"attributes":{},"tag":"codeblock","children":[{"mimes":{"text/html":"(tests = Any[], news = Any[(ts = (&quot;`protect`&quot;, quote\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:103 =#</span>\n    mutable struct C\n        <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:104 =#</span>\n        x::Int\n        <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:105 =#</span>\n        y::Int\n    end\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:108 =#</span>\n    mutable struct B\n        <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:109 =#</span>\n        c::C\n    end\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:112 =#</span>\n    mutable struct A\n        <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:113 =#</span>\n        b1::B\n        <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:114 =#</span>\n        b2::B\n    end\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:118 =#</span>\n    makea() = begin\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:118 =#</span>\n            A(B(C(1, 2)), B(C(3, 4)))\n        end\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:123 =#</span>\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:123 =#</span> @testset &quot;fully protected&quot; begin\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:124 =#</span>\n            a_p = protect(makea(), NamedTuple())\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:125 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:125 =#</span> @test_throws ProtectedException a_p.b1 isa Protected\n        end\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:128 =#</span>\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:128 =#</span> @testset &quot;read direct child&quot; begin\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:129 =#</span>\n            a_p2 = protect(makea(), (b1 = Read(),))\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:130 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:130 =#</span> @test_nowarn a_p2.b1\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:131 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:131 =#</span> @test_throws ProtectedException a_p2.b1 = C(5, 5)\n        end\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:134 =#</span>\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:134 =#</span> @testset &quot;write direct child&quot; begin\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:135 =#</span>\n            a_p2 = protect(makea(), (b1 = Write(),))\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:136 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:136 =#</span> @test_nowarn a_p2.b1\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:137 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:137 =#</span> @test_nowarn a_p2.b1 = B(C(5, 5))\n        end\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:139 =#</span>\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:139 =#</span> @testset &quot;write nested&quot; begin\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:140 =#</span>\n            a_p3 = protect(makea(), (b1 = (c = (x = Write(),),),))\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:141 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:141 =#</span> @test_nowarn a_p3.b1.c.x = 2\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:142 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:142 =#</span> @test_nowarn a_p3.b1.c.x\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:143 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:143 =#</span> @test a_p3.b1.c isa Protected\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:144 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:144 =#</span> @test_throws ProtectedException a_p3.b1.c.y = 2\n        end\nend), source = :(<span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/protect.jl:102 =#</span>)), (ts = (&quot;throttle&quot;, quote\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:117 =#</span>\n    function train(cb)\n        <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:117 =#</span>\n        <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:118 =#</span>\n        learner = testlearner(cb)\n        <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:119 =#</span>\n        epoch!(learner, TrainingPhase())\n        <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:120 =#</span>\n        return learner.cbstate.history[TrainingPhase()]\n    end\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:123 =#</span>\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:123 =#</span> @test (train(Recorder())).steps == 16\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:124 =#</span>\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:124 =#</span> @testset &quot;freq&quot; begin\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:125 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:125 =#</span> @test (train(throttle(Recorder(), StepEnd, freq = 2))).steps == 8\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:126 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:126 =#</span> @test (train(throttle(Recorder(), StepEnd, freq = 16))).steps == 1\n        end\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:129 =#</span>\n    if !(Base.Sys.iswindows())\n        <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:130 =#</span>\n        <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:130 =#</span> @testset &quot;seconds&quot; begin\n                <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:131 =#</span>\n                <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:131 =#</span> @test (train(throttle(Recorder(), StepEnd, seconds = 0))).steps == 16\n                <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:132 =#</span>\n                <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:132 =#</span> @test (train(throttle(Recorder(), StepEnd, seconds = 10))).steps == 1\n            end\n    end\nend), source = :(<span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/conditional.jl:116 =#</span>)), (ts = (&quot;CustomCallback&quot;, quote\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:41 =#</span>\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:41 =#</span> @testset &quot;Basic&quot; begin\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:42 =#</span>\n            x = 0\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:43 =#</span>\n            cb = CustomCallback((learner-&gt;begin\n                            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:43 =#</span>\n                            x += 1\n                        end), StepBegin)\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:44 =#</span>\n            learner = testlearner(cb)\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:45 =#</span>\n            epoch!(learner, TrainingPhase())\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:46 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:46 =#</span> @test x == 16\n        end\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:49 =#</span>\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:49 =#</span> @testset &quot;Interrupt&quot; begin\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:50 =#</span>\n            cb = CustomCallback(Events.StepEnd, TrainingPhase) do learner\n                    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:51 =#</span>\n                    throw(CancelFittingException(&quot;test&quot;))\n                end\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:53 =#</span>\n            learner = testlearner(Recorder(), cb, coeff = 3)\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:54 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:54 =#</span> @test_throws CancelFittingException epoch!(learner, TrainingPhase())\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:55 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:55 =#</span> @test (learner.cbstate.history[TrainingPhase()]).epochs == 0\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:56 =#</span>\n            <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:56 =#</span> @test (learner.cbstate.history[TrainingPhase()]).steps == 0\n        end\nend), source = :(<span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/custom.jl:40 =#</span>)), (ts = (&quot;Metric&quot;, quote\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/metrics.jl:257 =#</span>\n    cb = Metrics(Metric(accuracy, phase = ValidationPhase))\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/metrics.jl:258 =#</span>\n    learner = testlearner(Recorder(), cb)\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/metrics.jl:259 =#</span>\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/metrics.jl:259 =#</span> @test_nowarn fit!(learner, 1)\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/metrics.jl:260 =#</span>\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/metrics.jl:260 =#</span> @test :Accuracy ∈ keys(learner.cbstate.metricsstep[ValidationPhase()])\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/metrics.jl:261 =#</span>\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/metrics.jl:261 =#</span> @test !(:Accuracy ∈ keys(learner.cbstate.metricsstep[TrainingPhase()]))\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/metrics.jl:262 =#</span>\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/metrics.jl:262 =#</span> @test :Accuracy ∈ keys(learner.cbstate.metricsepoch[ValidationPhase()])\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/metrics.jl:263 =#</span>\n    <span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/metrics.jl:263 =#</span> @test !(:Accuracy ∈ keys(learner.cbstate.metricsepoch[TrainingPhase()]))\nend), source = :(<span class=\"sgr90\">#= /home/runner/.julia/packages/FluxTraining/iBFSd/src/callbacks/metrics.jl:256 =#</span>))], map = Dict{Union{Expr, String}, Int64}())"},"type":"leaf"}],"type":"node"}],"type":"node"}],"type":"node"}],"type":"node"}