<HTML><head><title>Hyperparameter scheduling</title><link href=../../template/hugobook.css rel=stylesheet ></link><meta content=Type=text/html; charset=utf-8 http-equiv=Content-Type ></meta></head><body><input onclick=toggleMenu() id=menu-control class=hidden toggle type=checkbox ></input><input id=toc-control type=checkbox class=hidden toggle ></input><main class=container flex ><aside id=menu-container class=book-menu ><nav class=book-menu-content ><h2 id=title >FluxTraining.jl</h2><div id=sidebar ><div class=doctree ><body><ul><li><p><a href=../../README.md.html title= >README</a></p></li><li><p><a href=../getting_started.md.html title= >Getting started</a></p></li><li><p><a href=../features.md.html title= >Features</a></p></li><li><p>Tutorials</p><ul><li><p><a href=mnist.ipynb.html title= >Training an image classifier</a></p></li><li><p><a href=hyperparameters.md.html title= >Hyperparameter scheduling</a></p></li><li><p><a href=../callbacks/custom.md.html title= >Writing a custom callback</a></p></li></ul></li><li><p>How to</p><ul><li><p><a href=../callbacks/usage.md.html title= >Use callbacks</a></p></li><li><p><a href=../callbacks/tipstricks.md.html title= >Tips &amp; tricks</a></p></li></ul></li><li><p>Reference</p><ul><li><p><a href=../../REFERENCE.html title= >Docstrings</a></p></li><li><p><a href=../training/basics.md.html title= >Training loop</a></p></li><li><p><a href=../callbacks/reference.md.html title= >Callbacks</a></p></li></ul></li></ul></body></div></div></nav></aside><div class=book-page ><header class=book-header ></header><article><h1 id=hyperparameter-scheduling >Hyperparameter scheduling</h1><p>When training neural networks, you often have to tune hyperparameters.</p><p>In <em>FluxTraining.jl</em> the following definition is used:</p><blockquote><p><em>A hyperparameter is any state that influences the training and is not a parameter of the model.</em></p></blockquote><p>Common hyperparameters to worry about are the learning rate, batch size and regularization strength.</p><p>In recent years, it has also become common practice to schedule some hyperparameters. The cyclical learning rate schedule introduced in <a href=https://arxiv.org/abs/1506.01186 title= >L. Smith 2015</a>, for example, changes the learning rate every step to speed up convergence.</p><p><em>FluxTraining.jl</em> provides an extensible interface for hyperparameter scheduling that is not restricted to optimizer hyperparameters as in many other training frameworks. To use it, you have to create a <a href=../../REFERENCE/FluxTraining.Scheduler.html ><code>Scheduler</code></a>, a callback that can be passed to a <a href=../../REFERENCE/FluxTraining.Learner.html ><code>Learner</code></a>.</p><p><code>Scheduler</code>’s constructor takes pairs of hyperparameter types and associated schedules.</p><p>As an example</p><ul><li><p><a href=../../REFERENCE/FluxTraining.LearningRate.html ><code>LearningRate</code></a> is a hyperparameter type representing the optimizer’s step size; and</p></li><li><p><code>schedule = Schedule([0, 10], [0.01, 0.001])</code> represents a linear scheduling over 10 epochs from <code>0.01</code> to <code>0.001</code></p></li></ul><p>We can create the callback scheduling the learning rate according to <code>Scheduler(LearningRate =&gt; schedule)</code>.</p><p><code>Schedule</code>s are built around <a href=https://jkrumbiegel.github.io/Animations.jl/dev/ title= ><em>Animations.jl</em></a>. See that package’s documentation or <a href=../../REFERENCE/FluxTraining.Schedule.html ><code>Schedule</code></a>’s for more details on how to construct them.</p><h3 id=one-cycle-learning-rate >One-cycle learning rate</h3><p>Let’s define a <code>Schedule</code> that follows the above-mentioned cyclical learning rate schedule.</p><p>The idea is to start with a small learning rate, gradually increase it, and then slowly decrease it again.</p><p>For example, we could start with a learning rate of 0.01, increase it to 0.1 over 3 epochs, and then down to 0.001 over 7 epochs. Let’s also use cosine annealing, a common practice that makes sure the values are interpolated more smoothly.</p><p>In code, that looks like this:</p><pre lang=julia ><code>using Animations: sineio  # for cosine annealing

es = length(traindl)     # number of steps in an epoch

schedule = Schedule(
    [0es, 3es, 10es],          # the time steps (in training steps)
    [0.01, 0.1, 0.001],  # the valus at the time steps
    sineio(),            # the annealing function
)

learner = model(model, data, opt, lossfn, Scheduler(LearningRate =&gt; schedule))
</code></pre><p>For convenience, you can also use the <a href=../../REFERENCE/FluxTraining.onecycle.html ><code>onecycle</code></a> helper to create this <code>Schedule</code>.</p><h2 id=extending >Extending</h2><p>You can create and schedule your own hyperparameters.</p><p>To do this, you will need to define</p><ul><li><p>a type for your hyperparameter, e.g. <code>abstract type MyParam &lt;: HyperParameter end</code>,</p></li><li><p>how to set the hyperparameter by implementing <a href=../../REFERENCE/FluxTraining.sethyperparameter!.html ><code>FluxTraining.sethyperparameter!</code></a><code>(learner, ::Type{MyParam}, value)</code></p></li><li><p>what state needs to be accessed to set the hyperparameter by implementing <a href=../../REFERENCE/FluxTraining.stateaccess.html ><code>FluxTraining.stateaccess</code></a><code>(::Type{MyParam})</code>. See <a href=../callbacks/custom.md.html title= >custom callbacks</a> for more info on why this is needed.</p></li></ul><div class=admonition ><p>Hyperparameters don’t need to belong to the optimizer! For example, you could create a hyperparameter for batch size. That is not implemented here because this package is agnostic of the data iterators and the implementation would differ for every type of iterator.</p></div></article><footer class=book-footer ></footer></div><aside class=book-toc ><nav id=toc class=book-toc-content ><ul><li><a href=#hyperparameter-scheduling >Hyperparameter scheduling</a><ul><li><a href=#extending >Extending</a><ul></ul></li></ul></li></ul></nav></aside></main></body></HTML>