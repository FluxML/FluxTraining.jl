{"attributes":{"backlinks":[{"tag":"document","title":"FluxTraining.jl","docid":"documents/README.md"},{"tag":"document","title":"Getting started","docid":"documents/docs/overview.md"},{"tag":"document","title":"toc","docid":"documents/toc.md"},{"tag":"document","title":"Features","docid":"documents/docs/features.md"}],"path":"/home/runner/.julia/packages/FluxTraining/Ccl32/docs/tutorials/hyperparameters.md","title":"Hyperparameter scheduling"},"tag":"document","children":[{"attributes":{},"tag":"h1","children":[{"mimes":{"text/plain":"Hyperparameter scheduling"}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"When training neural networks, you often have to tune hyperparameters"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"In "}},{"attributes":{},"tag":"em","children":[{"mimes":{"text/plain":"FluxTraining"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":"jl"}}]},{"mimes":{"text/plain":" the following definition is used:"}}]},{"attributes":{},"tag":"blockquote","children":[{"attributes":{},"tag":"p","children":[{"attributes":{},"tag":"em","children":[{"mimes":{"text/plain":"A hyperparameter is any state that influences the training and is not a parameter of the model"}},{"mimes":{"text/plain":"."}}]}]}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"Common hyperparameters to worry about are the learning rate, batch size and regularization strength"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"In recent years, it has also become common practice to schedule some hyperparameters"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" The cyclical learning rate schedule introduced in "}},{"attributes":{"href":"https://arxiv.org/abs/1506.01186","title":""},"tag":"a","children":[{"mimes":{"text/plain":"L"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" Smith 2015"}}]},{"mimes":{"text/plain":", for example, changes the learning rate every step to speed up convergence"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"p","children":[{"attributes":{},"tag":"em","children":[{"mimes":{"text/plain":"FluxTraining"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":"jl"}}]},{"mimes":{"text/plain":" provides an extensible interface for hyperparameter scheduling that is not restricted to optimizer hyperparameters as in many other training frameworks"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" To use it, you have to create a "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Scheduler"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Scheduler"}}]}]},{"mimes":{"text/plain":", a callback that can be passed to a "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Learner"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Learner"}}]}]},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"p","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Scheduler"}}]},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"s constructor takes pairs of hyperparameter types and associated schedules"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"As an example"}}]},{"attributes":{},"tag":"ul","children":[{"attributes":{},"tag":"li","children":[{"attributes":{},"tag":"p","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.LearningRate"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"LearningRate"}}]}]},{"mimes":{"text/plain":" is a hyperparameter type representing the optimizer"}},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"s step size; and"}}]}]},{"attributes":{},"tag":"li","children":[{"attributes":{},"tag":"p","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"schedule = Schedule([0, 10], [0.01, 0.001])"}}]},{"mimes":{"text/plain":" represents a linear scheduling over 10 epochs from "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"0.01"}}]},{"mimes":{"text/plain":" to "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"0.001"}}]}]}]}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"We can create the callback scheduling the learning rate according to "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Scheduler(LearningRate => schedule)"}}]},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"p","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Schedule"}}]},{"mimes":{"text/plain":"s are built around "}},{"attributes":{"href":"https://jkrumbiegel.github.io/Animations.jl/dev/","title":""},"tag":"a","children":[{"attributes":{},"tag":"em","children":[{"mimes":{"text/plain":"Animations"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":"jl"}}]}]},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" See that package"}},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"s documentation or "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Schedule"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Schedule"}}]}]},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"s for more details on how to construct them"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"h3","children":[{"mimes":{"text/plain":"One"}},{"mimes":{"text/plain":"-"}},{"mimes":{"text/plain":"cycle learning rate"}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"Let"}},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"s define a "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Schedule"}}]},{"mimes":{"text/plain":" that follows the above"}},{"mimes":{"text/plain":"-"}},{"mimes":{"text/plain":"mentioned cyclical learning rate schedule"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"The idea is to start with a small learning rate, gradually increase it, and then slowly decrease it again"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"For example, we could start with a learning rate of 0"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":"01, increase it to 0"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":"1 over 3 epochs, and then down to 0"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":"001 over 7 epochs"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" Let"}},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"s also use cosine annealing, a common practice that makes sure the values are interpolated more smoothly"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"In code, that looks like this:"}}]},{"attributes":{"lang":"julia"},"tag":"codeblock","children":[{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_using","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_KEYWORD","children":[{"mimes":{"text/plain":"using"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"Animations"}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":": "}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"sineio"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":"  # for cosine annealing\n\n"}}]}]}]}]}]}]},{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"es"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"length"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"traindl"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")     # number of steps in an epoch\n\n"}}]}]}]}]},{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"schedule"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Schedule"},"tag":"reference","children":[{"mimes":{"text/plain":"Schedule"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"(\n    "}}]},{"attributes":{},"tag":"CST_vect","children":[{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"["}}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_INTEGER","children":[{"mimes":{"text/plain":"0"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":""}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"es"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_INTEGER","children":[{"mimes":{"text/plain":"3"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":""}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"es"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_INTEGER","children":[{"mimes":{"text/plain":"10"}}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":""}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"es"}}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"]"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",          # the time steps (in training steps)\n    "}}]},{"attributes":{},"tag":"CST_vect","children":[{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"["}}]},{"attributes":{},"tag":"CST_FLOAT","children":[{"mimes":{"text/plain":"0.01"}}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_FLOAT","children":[{"mimes":{"text/plain":"0.1"}}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_FLOAT","children":[{"mimes":{"text/plain":"0.001"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"]"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",  # the valus at the time steps\n    "}}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"sineio"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")"}}]}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":",            # the annealing function\n"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")\n\n"}}]}]}]}]},{"attributes":{},"tag":"CST_DEFINITION","children":[{"attributes":{},"tag":"CST_OPERATOR","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"learner"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"= "}}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"model"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"model"}}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"data"}}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"opt"}}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"lossfn"}}]},{"attributes":{},"tag":"CST_PUNCTUATION","children":[{"mimes":{"text/plain":", "}}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.Scheduler"},"tag":"reference","children":[{"mimes":{"text/plain":"Scheduler"}}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":"("}}]},{"attributes":{},"tag":"CST_call","children":[{"attributes":{},"tag":"CST_span","children":[{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.LearningRate"},"tag":"reference","children":[{"mimes":{"text/plain":"LearningRate"}}]},{"attributes":{},"tag":"CST_whitespace","children":[{"mimes":{"text/plain":" "}}]}]},{"attributes":{},"tag":"CST_OPERATOR","children":[{"mimes":{"text/plain":"=> "}}]},{"attributes":{},"tag":"CST_IDENTIFIER","children":[{"mimes":{"text/plain":"schedule"}}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")"}}]}]},{"attributes":{},"tag":"CST_BRACKET","children":[{"mimes":{"text/plain":")"}}]}]}]}]}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"For convenience, you can also use the "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.onecycle"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"onecycle"}}]}]},{"mimes":{"text/plain":" helper to create this "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"Schedule"}}]},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"h2","children":[{"mimes":{"text/plain":"Extending"}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"You can create and schedule your own hyperparameters"}},{"mimes":{"text/plain":"."}}]},{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"To do this, you will need to define"}}]},{"attributes":{},"tag":"ul","children":[{"attributes":{},"tag":"li","children":[{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"a type for your hyperparameter, e"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":"g"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" "}},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"abstract type MyParam <: HyperParameter end"}}]},{"mimes":{"text/plain":","}}]}]},{"attributes":{},"tag":"li","children":[{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"how to set the hyperparameter by implementing "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.sethyperparameter!"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"sethyperparameter!"}}]}]},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"(learner, ::Type{MyParam}, value)"}}]}]}]},{"attributes":{},"tag":"li","children":[{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"what state needs to be accessed to set the hyperparameter by implementing "}},{"attributes":{"reftype":"symbol","document_id":"references/FluxTraining.stateaccess"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"stateaccess"}}]}]},{"attributes":{},"tag":"code","children":[{"mimes":{"text/plain":"(::Type{MyParam})"}}]},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" See "}},{"attributes":{"reftype":"document","href":"../callbacks/custom.md","title":"","document_id":"documents/docs/callbacks/custom.md"},"tag":"reference","children":[{"mimes":{"text/plain":"custom callbacks"}}]},{"mimes":{"text/plain":" for more info on why this is needed"}},{"mimes":{"text/plain":"."}}]}]}]},{"attributes":{"class":"info"},"tag":"admonition","children":[{"attributes":{},"tag":"admonitiontitle","children":[{"mimes":{"text/plain":"Kinds of hyperparameters"}}]},{"attributes":{},"tag":"admonitionbody","children":[{"attributes":{},"tag":"p","children":[{"mimes":{"text/plain":"Hyperparameters don"}},{"mimes":{"text/plain":"’"}},{"mimes":{"text/plain":"t need to belong to the optimizer"}},{"mimes":{"text/plain":"!"}},{"mimes":{"text/plain":" For example, you could create a hyperparameter for batch size"}},{"mimes":{"text/plain":"."}},{"mimes":{"text/plain":" That is not implemented here because this package is agnostic of the data iterators and the implementation would differ for every type of iterator"}},{"mimes":{"text/plain":"."}}]}]}]}]}